<!DOCTYPE html>
<!--
Created by       : Luis MartinGarcia <http://www.aldabaknocking.com>
Original design  : "Collaboration" by Free CSS Templates (later "TEMPLATED")
Original license : Creative Commons Attribution 2.5 License
-->
<html lang="en">

    <!-- HEAD -->
    <head>
        <meta charset="utf-8">
        <title>Realtek switch tag | TCPDUMP &amp; LIBPCAP</title>
        <meta name="keywords" content="tcpdump, libpcap, pcap, packet capture, sniffer, security, eavesdrop">
        <meta name="description" content="Web site of Tcpdump and Libpcap">
        <link href="../style.css" rel="stylesheet" type="text/css" media="screen">
        <link href="../images/T-32x32.png" rel="shortcut icon" type="image/png">
        <link rel="canonical" href="https://www.tcpdump.org">
    </head>
    <!-- END OF HTML HEAD -->

    <!-- BODY -->
    <body>

        <!-- TOP MENU -->
        <div id="menu">
            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../security.html">Security</a></li>
                <li><a href="../faq.html">FAQ</a></li>
                <li><a href="../manpages/">Man Pages</a></li>
                <li><a href="../ci.html">CI</a></li>
                <li><a href="../linktypes.html">Link-Layer Header Types</a></li>
                <li><a href="../related.html">See Also</a></li>
                <li><a href="../old_releases.html">Old Releases</a></li>
            </ul>
        </div>
        <!-- END OF TOP MENU -->

        <!-- PAGE HEADER -->
        <div id="splash">
            <br><img src="../images/logo.png" alt="">
        </div>
        <div id="logo">
            <hr>
        </div>
        <!-- END OF PAGE HEADER -->

        <!-- PAGE CONTENTS -->
        <div id="page">

          <!-- Start of Realtek switch tag section -->
          <div class="post">
            <h2 class="title">
                Realtek switch tag
            </h2>
            <div class="entry">
                <h3>Switch tag structure</h3>
The Realtek <code>0x8899</code> is a proprietary Ethertype used for remote control,
loop detection, and packet tagging (DSA). There are three known tag protocols:

<ul>
	<li><code>0x9</code> (4-byte long tag)
	<li><code>0xA</code> (4-byte long tag)
	<li><code>0x04</code> (8-byte long tag)
</ul>

The next payload Ethertype is immediately after the DSA tag.

<section id="rtl4_9">
<h3>Protocol version 0x9</h3>

The Realtek protocol 0x9 is a 4 bytes ethertype tag used for unmanaged switches

<pre>
  7   6   5   4   3   2   1   0  
  .   .   .   .   .   .   .   .   .
  +---+---+---+---+---+---+---+---+
  |   Ether Destination Address   |
  +---+---+---+---+---+---+---+---+
  |     Ether Source Address      |
  +---+---+---+---+---+---+---+---+  --
  |   Realktek Ether Type [15:8]  |  |
  +---+---+---+---+---+---+---+---+  |
  |   Realktek Ether Type [7:0]   |  | 
  +---+---+---+---+---+---+---+---+  | EDSA tag
  |   Protocol    |  PRI  | b1| b2|  |
  +---+---+---+---+---+---+---+---+  |
  | b3| b4|         RX/TX         |  |
  +---+---+---+---+---+---+---+---+  --
  |           Ether Type          |
  +---+---+---+---+---+---+---+---+
  .   .   .   .   .   .   .   .   .
</pre>

<ul>
	<li> Realktek Ether Type: <code>0x8899</code>
	<li> Protocol: <code>0x9</code>
	<li> PRI: Priority
	<li> b1: Disable learning of source MAC address
	<li> b2: reserved
	<li> b3: reserved
	<li> b4: reserved
	<li> TX/RX:
		<ol>
			<li> TX to CPU: indicate the receive port number
			<li> RX from CPU: indicate the forwarding port mask
		</ol>
</ul>
</section>

<section id="rtl4_a">
<h3>Protocol version 0xA</h3>

The Realtek protocol 0xA is a 4 bytes ethertype tag used for unmanaged switches.
There is no official doc about this protocol and this information and even the Linux
tag driver was written based on reverse engineering.

<pre>
  7   6   5   4   3   2   1   0  
  .   .   .   .   .   .   .   .   .
  +---+---+---+---+---+---+---+---+
  |   Ether Destination Address   |
  +---+---+---+---+---+---+---+---+
  |     Ether Source Address      |
  +---+---+---+---+---+---+---+---+  --
  |   Realktek Ether Type [15:8]  |  |
  +---+---+---+---+---+---+---+---+  |
  |   Realktek Ether Type [7:0]   |  | 
  +---+---+---+---+---+---+---+---+  | EDSA tag
  |   Protocol    | b1| b2| b3| b4|  |
  +---+---+---+---+---+---+---+---+  |
  |            RX/TX              |  |
  +---+---+---+---+---+---+---+---+  --
  |           Ether Type          |
  +---+---+---+---+---+---+---+---+
  .   .   .   .   .   .   .   .   .

</pre>

<ul>
	<li> Realktek Ether Type: <code>0x8899</code>
	<li> Protocol: <code>0xA</code>
	<li> b1: unknown
	<li> b2: unknown
	<li> b3: unknown
	<li> b4: unknown
	<li> TX/RX:
		<ol>
			<li> TX to CPU: indicate the receive port number
			<li> RX from CPU: indicate the forwarding port mask
		</ol>
</ul>
</section>

<section id="rtl8_4">
<h3>Protocol version 0x04</h3>

The Realtek protocol 0x04 is an 8-byte ethertype tag used for unmanaged switches

<pre>
  7   6   5   4   3   2   1   0  
  .   .   .   .   .   .   .   .   .
  +---+---+---+---+---+---+---+---+
  |   Ether Destination Address   |
  +---+---+---+---+---+---+---+---+
  |     Ether Source Address      |
  +---+---+---+---+---+---+---+---+  --
  |   Realktek Ether Type [15:8]  |  |
  +---+---+---+---+---+---+---+---+  |
  |   Realktek Ether Type [7:0]   |  | 
  +---+---+---+---+---+---+---+---+  |
  |            Protocol           |  |
  +---+---+---+---+---+---+---+---+  |
  |             Reason            |  |
  +---+---+---+---+---+---+---+---+  | EDSA tag
  | b1|EncFID[2:0]| b2| PRI [2:0] |  |
  +---+---+---+---+---+---+---+---+  |
  | b3| b4| b5|    VIDX [4:0]     |  |
  +---+---+---+---+---+---+---+---+  |
  | b6|         TX/RX[14:8]       |  |
  +---+---+---+---+---+---+---+---+  |
  |           TX/RX[7:0]          |  |
  +---+---+---+---+---+---+---+---+  --
  |           Ether Type          |
  +---+---+---+---+---+---+---+---+
  .   .   .   .   .   .   .   .   .
</pre>

<ul>
	<li> Realktek Ether Type: <code>0x8899</code>
	<li> Protocol: <code>0x04</code>
	<li> Reason:
		<ol>
			<li> <code>0x00</code>: packet was forwarded or flooded to CPU
			<li> <code>0x80</code>: packet was trapped to CPU
		</ol>
	<li> b1: Enable EFID
		<ol>
			<li> <code>0x0</code>: Don't force EFID
			<li> <code>0x1</code>: Force EFID
		</ol>
	<li> EncFID: Enhanced FID (if <code>b1==1</code>)
	<li> b2: Enable priority
		<ol>
			<li> <code>0x0</code>: Don't force priority
			<li> <code>0x1</code>: Force priority
		</ol>
	<li> PRI: Priority (if <code>b2==1</code>)
	<li> b3: keep VLAN tag format
	<li> b4: Enable VLAN
		<ol>
			<li> <code>0x0</code>: Don't force VLAN
			<li> <code>0x1</code>: Force VLAN
		</ol>
	<li> b5: Disable learning of source MAC address
	<li> VIDX: index point to VLAN
	<li> b6: Use TX/RX as allowance mask
		<ol>
			<li> <code>0x0</code>: no allowance port mask, TX/RX is the forwarding port mask
			<li> <code>0x1</code>: use TX/RX as allowance port mask (don't forward do any port not set in TX/RX)
		</ol>
	<li> TX/RX:
		<ol>
			<li> TX to CPU: indicate the receive port number
			<li> RX from CPU: indicate the forwarding (if <code>b6==0</code>) or allowance port mask (if <code>b6==1</code>)
		</ol>
</ul>
</section>
            </div>
            <!-- End of Realtek switch tag section -->
          </div>
        </div>
        <!-- END OF PAGE CONTENTS -->

        <!-- FOOTER -->
        <div id="footer">
            <p>
                &copy; 2010&ndash;2021 The Tcpdump Group. Designed by
                <a class=away href="https://www.luismg.com/">Luis MartinGarcia</a>;
                based on a template by TEMPLATED.
            </p>
        </div>
        <!-- END OF FOOTER -->

    </body>
    <!-- END OF HTML BODY -->
</html>
